<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>大富豪 - 5人対戦</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    {% include '_header.html' %}
    <div class="layout layout--game">
        <aside class="left-pane">
            <div class="card">
                <div class="badge">ルーム</div>
                <h3 class="title">大富豪（5人対戦）</h3>
                <p class="desc">必ず5人で遊びます。足りない場合はボットが参加します。招待リンクを生成して友達を呼んでください。</p>

                <label>あなたの名前</label>
                <input id="playerName" type="text" placeholder="名前（例: 太郎）" value="Player">

                <div style="margin-top:10px">
                    <button id="createRoom" class="btn">ルーム作成</button>
                    <button id="joinRoom" class="btn btn-secondary">ルームに参加</button>
                </div>

                <div style="margin-top:12px">
                    <input id="roomIdInput" type="text" placeholder="参加するルームID（または招待リンク）」>
                </div>

                <div style="margin-top:12px">
                    <label>招待リンク</label>
                    <div id="inviteArea" class="mono small muted">— まだ作成されていません —</div>
                </div>

                <div style="margin-top:12px">
                    <label>ボットの思考時間</label>
                    <select id="botThinkDelay" style="width:100%; margin-top:6px;">
                        <!-- options inserted by JS if not present -->
                    </select>
                    <small class="muted small">ボットが考える時間（2〜20秒）</small>
                </div>

                <!-- Room rules panel -->
                <div style="margin-top:14px; border-top:1px dashed #eee; padding-top:10px;">
                    <div style="font-weight:700; margin-bottom:6px">ルームルール（任意）</div>
                    <div style="display:flex; flex-direction:column; gap:6px;">
                        <label><input type="checkbox" id="rule_spade3_over_joker"> スペード3 がジョーカーに勝つ</label>
                        <label style="margin-left:16px;"><input type="checkbox" id="rule_spade3_single_only"> （単発のみ適用）</label>
                        <label><input type="checkbox" id="rule_block_8_after_2"> 場に2がある場合 8 をブロック</label>
                        <label><input type="checkbox" id="rule_auto_pass_no_joker_vs_2"> 人間がジョーカーを持っていなければ自動パス</label>
                    </div>
                    <div style="margin-top:8px; display:flex; gap:8px;">
                        <button id="saveRulesBtn" class="btn btn-primary">設定を保存</button>
                        <button id="reloadRulesBtn" class="btn btn-secondary">設定を再読込</button>
                    </div>
                    <small class="muted small">このルーム固有のルールです。変更は即時反映されます。</small>
                </div>

                <div style="margin-top:12px">
                    <label>おすすめルーム（途中参加可能なボットスロット）</label>
                    <div style="display:flex; gap:8px; margin-top:6px;">
                        <input id="externalServers" type="text" placeholder="外部サーバーのURL,カンマ区切り (任意)" style="flex:1" />
                        <button id="refreshRecommended" class="btn">更新</button>
                    </div>
                    <div id="recommendedArea" style="margin-top:8px">
                        <!-- recommended rooms list inserted by JS -->
                    </div>
                </div>

                <div style="margin-top:12px" id="playersListArea">
                    <label>プレイヤー一覧</label>
                    <ul id="playersList" class="players-list"></ul>
                </div>
                <!-- Bot add modal trigger & modal markup -->
                <div id="botAddArea" style="margin-top:8px">
                    <!-- button inserted by JS -->
                </div>

                <div style="margin-top:12px">
                    <button id="startGame" class="btn btn-primary">ゲーム開始（足りなければボットが参戦）</button>
                </div>

            </div>
        </aside>

        <main class="content">
            <div style="padding:20px; max-width:900px; margin:auto;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>場に出されたカード</h2>
                    <div id="currentTurnBanner" class="current-turn-banner" style="font-weight:bold; color:#2b6cb0;">-- のターン</div>
                    <div id="clock" class="muted small mono">--:--:--</div>
                </div>
                <div id="centerPile" class="center-pile"></div>

                <h2>あなたの手札</h2>
                <div id="handRow" class="hand-row"></div>
                <div style="margin-top:8px; display:flex; gap:8px;">
                    <button id="playSelected" class="btn btn-primary">出す（選択中を出す）</button>
                    <button id="passTurn" class="btn btn-secondary">パス</button>
                </div>

                <section style="margin-top:20px;">
                    <h3>ルームチャット</h3>
                    <div id="chatBox" class="chat-box"></div>
                    <div style="display:flex; gap:8px; margin-top:8px;">
                        <input id="chatInput" type="text" placeholder="メッセージを入力" style="flex:1">
                        <button id="sendChat" class="btn">送信</button>
                    </div>
                </section>

                <section style="margin-top:12px;">
                    <h3>ラウンド結果</h3>
                    <div id="resultsArea" class="results-area"></div>
                </section>

                <section style="margin-top:18px; display:flex; gap:8px; align-items:center;">
                    <button id="copyInvite" class="btn">招待リンクをコピー</button>
                    <button id="shareInvite" class="btn btn-secondary">共有（シェア）</button>
                </section>
                <div style="margin-top:8px;">
                    <span id="sseStatus" class="sse-status sse-disconnected">SSE: 切断</span>
                    <span id="directionBadge" class="direction-badge" style="margin-left:12px;">進行: 時計回り</span>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='daifugo.js') }}"></script>
    <div id="toast" class="toast" aria-live="polite" style="display:none"></div>
    <!-- Give back modal (富豪/大富豪が渡すカードを選択) -->
    <div id="giveModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="giveModalTitle" style="display:none">
        <div class="modal-content" tabindex="-1">
            <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px">
                <div id="giveRecipientAvatar" class="avatar"></div>
                <div>
                    <h3 id="giveModalTitle" style="margin:0;">カードを選択してください</h3>
                    <div id="giveRecipientInfo" class="muted small" style="margin-top:4px">--</div>
                </div>
            </div>
            <div id="giveHand" class="hand-row" style="margin-bottom:12px"></div>
            <div style="display:flex; gap:8px; justify-content:flex-end;">
                <button id="giveCancel" class="btn btn-secondary">キャンセル</button>
                <button id="giveSubmit" class="btn btn-primary">渡す</button>
            </div>
        </div>
    </div>
    <!-- Mass-discard (Q) selection modal -->
    <div id="massDiscardModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="massDiscardModalTitle" style="display:none">
        <div class="modal-content" tabindex="-1">
            <h3 style="margin-top:0;">12(Q) を出しました — 対象ランクを選んでください</h3>
            <p class="muted small">対象にするランクを選ぶと、そのランクを全員が場に捨てます。A, K, 10, 9 等を選択できます。</p>
            <div id="massRankButtons" style="display:flex; gap:8px; flex-wrap:wrap; margin:8px 0;">
                <!-- buttons inserted by JS -->
            </div>
            <div style="margin-top:8px; display:flex; gap:8px; justify-content:flex-end; align-items:center;">
                <input id="massRankCustom" type="text" placeholder="手動入力: 例 A, K, 10" style="flex:1" />
                <button id="massDiscardCancel" class="btn btn-secondary">キャンセル</button>
                <button id="massDiscardSubmit" class="btn btn-primary">送信</button>
            </div>
        </div>
    </div>
    <!-- Bot 編集モーダル -->
    <div id="botEditModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="botEditTitle" style="display:none">
        <div class="modal-content" tabindex="-1">
            <h3 id="botEditTitle">ボットを編集</h3>
            <div style="display:flex; flex-direction:column; gap:8px; margin-top:8px;">
                <label>表示名</label>
                <input id="botDisplayName" type="text" placeholder="例: イジヒコ">
                <label>口調</label>
                <select id="botTone">
                    <option>真面目くん</option>
                    <option>不思議ちゃん</option>
                    <option selected>いじわる</option>
                </select>
                <label>難易度</label>
                <select id="botDifficulty">
                    <option>弱い</option>
                    <option selected>ふつう</option>
                    <option>強い</option>
                </select>
            </div>
            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
                <button id="botEditCancel" class="btn btn-secondary">キャンセル</button>
                <button id="botEditSave" class="btn btn-primary">保存</button>
            </div>
        </div>
    </div>
    <!-- Join Bot Slot modal -->
    <div id="joinBotModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="joinBotText" style="display:none">
        <div class="modal-content" tabindex="-1">
            <h3 style="margin-top:0;">ボットスロットに途中参加</h3>
            <p id="joinBotText" class="muted small">このボットスロットに途中参加しますか？</p>
            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
                <button id="joinBotCancel" class="btn btn-secondary">キャンセル</button>
                <button id="joinBotConfirm" class="btn btn-primary">参加する</button>
            </div>
            <input type="hidden" id="joinBotRoomId" />
            <input type="hidden" id="joinBotBotId" />
        </div>
    </div>
</body>
</html>