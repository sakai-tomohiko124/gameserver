<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小説とゲーム</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="theme-color" content="#2E7D32">
    <style>
        /* 簡易フォールバックフォント */
        body { font-family: 'Noto Sans JP', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    </style>
</head>
<body>
    {% include '_header.html' %}
    <div class="layout layout--centered">
        <aside class="left-pane">
            <div class="card">
                <div class="badge">おすすめ小説</div>
                <h3 class="title">{{ novel.title }}</h3>
                <p class="author">作者: {{ novel.author }}</p>
                <p class="desc clamp-3"><span class="desc-inner">{{ novel.description }}</span></p>
                <div class="actions">
                    <a class="btn" href="{{ novel.url }}" target="_blank">小説を読む</a>
                    <a class="btn btn-secondary" href="/game/daifugo">大富豪をプレイ</a>
                </div>
            </div>
        </aside>
        <script src="{{ url_for('static', filename='daifugo.js') }}"></script>
        <script>
        // トップページの説明文を3行で折りたたみ、ボタンでスムーズに展開/折りたたみする
        document.addEventListener('DOMContentLoaded', function(){
            const descEl = document.querySelector('.desc');
            if(!descEl) return;
            const inner = descEl.querySelector('.desc-inner');
            if(!inner) return;

            // 初期 collapsed 高さ（3行分）を算出
            const computed = window.getComputedStyle(inner);
            const lineHeight = parseFloat(computed.lineHeight) || parseFloat(computed.fontSize) * 1.2;
            const collapsedH = Math.round(lineHeight * 3);

            descEl.style.maxHeight = collapsedH + 'px';
            descEl.style.overflow = 'hidden';
            descEl.style.transition = 'max-height 320ms cubic-bezier(.2,.8,.2,1)';

            const btn = document.createElement('button');
            btn.className = 'btn btn-secondary toggle-desc';
            btn.type = 'button';
            btn.textContent = '続きを表示';
            let expanded = false;

            btn.addEventListener('click', function(){
                if(!expanded){
                    // expand to full scrollHeight then remove max-height after transition to allow flexible content
                    const targetH = inner.scrollHeight;
                    descEl.style.maxHeight = targetH + 'px';
                    btn.textContent = '折りたたむ';
                    expanded = true;
                    // after transition, remove max-height to allow responsive resizing
                    setTimeout(()=>{ descEl.style.maxHeight = 'none'; }, 350);
                } else {
                    // collapse: set max-height back to collapsedH
                    // ensure current maxHeight is set to pixel value before animating
                    descEl.style.maxHeight = inner.scrollHeight + 'px';
                    // force reflow
                    // eslint-disable-next-line no-unused-expressions
                    descEl.offsetHeight;
                    descEl.style.maxHeight = collapsedH + 'px';
                    btn.textContent = '続きを表示';
                    expanded = false;
                }
            });

            descEl.parentNode.appendChild(btn);
        });
        </script>
        <main class="content">
            <!-- 右側は余白または将来のコンテンツ用 -->
        </main>
    </div>
</body>
</html>